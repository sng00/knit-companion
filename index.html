<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #3875c1; -webkit-text-stroke: #3875c1; background-color: #ffffff; background-color: rgba(255, 255, 255, 0)}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #7cc9fe; -webkit-text-stroke: #7cc9fe; background-color: #ffffff; background-color: rgba(255, 255, 255, 0)}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #b36a52; -webkit-text-stroke: #b36a52; background-color: #ffffff; background-color: rgba(255, 255, 255, 0)}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #bfbfbe; -webkit-text-stroke: #bfbfbe; background-color: #ffffff; background-color: rgba(255, 255, 255, 0)}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #bfbfbe; -webkit-text-stroke: #bfbfbe; background-color: #ffffff; background-color: rgba(255, 255, 255, 0); min-height: 16.0px}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #5a6065; -webkit-text-stroke: #5a6065; background-color: #ffffff; background-color: rgba(255, 255, 255, 0)}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #61b670; -webkit-text-stroke: #61b670; background-color: #ffffff; background-color: rgba(255, 255, 255, 0)}
    span.s1 {font-kerning: none}
    span.s2 {font-kerning: none; color: #7cc9fe; -webkit-text-stroke: 0px #7cc9fe}
    span.s3 {font-kerning: none; color: #5a5a5a; -webkit-text-stroke: 0px #5a5a5a}
    span.s4 {font-kerning: none; color: #bfbfbe; -webkit-text-stroke: 0px #bfbfbe}
    span.s5 {font-kerning: none; color: #b36a52; -webkit-text-stroke: 0px #b36a52}
    span.s6 {font-kerning: none; color: #3875c1; -webkit-text-stroke: 0px #3875c1}
    span.s7 {font-kerning: none; color: #5a6065; -webkit-text-stroke: 0px #5a6065}
    span.s8 {font-kerning: none; color: #cacaca; -webkit-text-stroke: 0px #cacaca}
    span.s9 {font-kerning: none; color: #f16625; -webkit-text-stroke: 0px #f16625}
    span.s10 {font-kerning: none; color: #61b670; -webkit-text-stroke: 0px #61b670}
    span.s11 {font-kerning: none; color: #97bb86; -webkit-text-stroke: 0px #97bb86}
    span.s12 {font-kerning: none; color: #a752f5; -webkit-text-stroke: 0px #a752f5}
    span.s13 {font-kerning: none; color: #30b68f; -webkit-text-stroke: 0px #30b68f}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE</span><span class="s2"> html</span><span class="s1">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">html</span><span class="s4"> </span><span class="s2">lang</span><span class="s3">=</span><span class="s5">"en"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s1">charset</span><span class="s3">=</span><span class="s5">"UTF-8"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"viewport"</span><span class="s4"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"apple-mobile-web-app-capable"</span><span class="s4"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"yes"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"apple-mobile-web-app-status-bar-style"</span><span class="s4"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"black-translucent"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">title</span><span class="s3">&gt;</span><span class="s1">PDF Pattern Companion</span><span class="s3">&lt;/</span><span class="s6">title</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">&lt;!-- Tailwind CSS --&gt;</span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdn.tailwindcss.com"</span><span class="s3">&gt;&lt;/</span><span class="s6">script</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">&lt;!-- PDF.js --&gt;</span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"</span><span class="s3">&gt;&lt;/</span><span class="s6">script</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">&lt;!-- FontAwesome --&gt;</span><span class="s3">&lt;</span><span class="s6">link</span><span class="s4"> </span><span class="s2">rel</span><span class="s3">=</span><span class="s1">"stylesheet"</span><span class="s4"> </span><span class="s2">href</span><span class="s3">=</span><span class="s1">"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>tailwind</span><span class="s8">.</span><span class="s1">config </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>theme</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>extend</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>colors</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>yarn</span><span class="s8">:</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s9">50</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'#f0f9ff'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s9">100</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'#e0f2fe'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s9">200</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'#bae6fd'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s9">300</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'#7dd3fc'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s9">400</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'#38bdf8'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s9">500</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'#0ea5e9'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s9">600</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'#0284c7'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s9">700</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'#0369a1'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s9">800</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'#075985'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s9">900</span><span class="s8">:</span><span class="s1"> </span><span class="s10">'#0c4a6e'</span><span class="s8">,</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">/* Custom Scrollbar */</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">::-webkit-scrollbar</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">width:</span><span class="s1"> </span><span class="s11">8px</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">height:</span><span class="s1"> </span><span class="s11">8px</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">::-webkit-scrollbar-track</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background:</span><span class="s1"> #27272a</span><span class="s8">;</span><span class="s1"> </span><span class="s7">/* dark track */</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">::-webkit-scrollbar-thumb</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background:</span><span class="s1"> #0ea5e9</span><span class="s8">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">border-radius:</span><span class="s4"> </span><span class="s11">4px</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">::-webkit-scrollbar-thumb:hover</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background:</span><span class="s1"> #0284c7</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.no-select</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">user-select:</span><span class="s1"> </span><span class="s5">none</span><span class="s8">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">-webkit-user-select:</span><span class="s4"> </span><span class="s5">none</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">.loader</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border:</span><span class="s1"> </span><span class="s11">4px</span><span class="s1"> </span><span class="s5">solid</span><span class="s1"> #f3f3f3</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border-top:</span><span class="s1"> </span><span class="s11">4px</span><span class="s1"> </span><span class="s5">solid</span><span class="s1"> #0ea5e9</span><span class="s8">;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">border-radius:</span><span class="s4"> </span><span class="s11">50%</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">width:</span><span class="s1"> </span><span class="s11">30px</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">height:</span><span class="s1"> </span><span class="s11">30px</span><span class="s8">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">animation:</span><span class="s4"> </span><span class="s1">spin</span><span class="s4"> </span><span class="s11">1s</span><span class="s4"> </span><span class="s1">linear</span><span class="s4"> </span><span class="s1">infinite</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">@keyframes</span><span class="s1"> </span><span class="s5">spin</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">0%</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s2">transform:</span><span class="s1"> </span><span class="s5">rotate(</span><span class="s11">0deg</span><span class="s5">)</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">100%</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s2">transform:</span><span class="s1"> </span><span class="s5">rotate(</span><span class="s11">360deg</span><span class="s5">)</span><span class="s8">;</span><span class="s1"> </span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">#the-canvas</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">max-width:</span><span class="s1"> </span><span class="s5">none</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">#resizer</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">transition:</span><span class="s4"> </span><span class="s1">background-color</span><span class="s4"> </span><span class="s11">0.2s</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">z-index:</span><span class="s1"> </span><span class="s11">30</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">/* Dark mode active color for resizer */</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">#resizer:hover</span><span class="s8">,</span><span class="s4"> </span><span class="s1">#resizer.active</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #4b5563</span><span class="s8">;</span><span class="s1"> </span><span class="s7">/* gray-600 */</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">/* Ruler Style */</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">#ruler</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">cursor:</span><span class="s1"> </span><span class="s5">move</span><span class="s8">;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">/* Default styles are added dynamically but keep this here for reference */</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s3">&lt;</span><span class="s6">body</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-gray-900 h-screen flex flex-col overflow-hidden text-gray-100 font-sans"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">&lt;!-- Main Content Area --&gt;</span><span class="s3">&lt;</span><span class="s6">main</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"mainContainer"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex-1 flex flex-col md:flex-row overflow-hidden relative"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">&lt;!-- PDF Viewer Section --&gt;</span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex-1 flex flex-col relative bg-gray-100 h-full min-w-0"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s7">&lt;!-- PDF Toolbar (Dark Mode) --&gt;</span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"pdfToolbar"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-gray-800 border-b border-gray-700 p-2 flex items-center justify-between gap-2 z-10 shadow-xl flex-none"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">&lt;!-- Page Navigation Group --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"navGroup"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex items-center gap-2 hidden"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"prevPage"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"p-2 hover:bg-gray-700 rounded text-gray-300"</span><span class="s4"> </span><span class="s2">title</span><span class="s3">=</span><span class="s1">"Previous Page"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">i</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"fa-solid fa-chevron-left"</span><span class="s3">&gt;&lt;/</span><span class="s6">i</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-sm font-medium text-gray-300 whitespace-nowrap"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>Page </span><span class="s3">&lt;</span><span class="s6">span</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"pageNum"</span><span class="s3">&gt;</span><span class="s1">1</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span><span class="s1"> / </span><span class="s3">&lt;</span><span class="s6">span</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"pageCount"</span><span class="s3">&gt;</span><span class="s1">--</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"nextPage"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"p-2 hover:bg-gray-700 rounded text-gray-300"</span><span class="s4"> </span><span class="s2">title</span><span class="s3">=</span><span class="s1">"Next Page"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">i</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"fa-solid fa-chevron-right"</span><span class="s3">&gt;&lt;/</span><span class="s6">i</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex items-center gap-2"</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">&lt;!-- Upload Button (Yarn color) --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">onclick</span><span class="s3">=</span><span class="s1">"document.getElementById('fileInput').click()"</span><span class="s4"><span class="Apple-converted-space"> </span></span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                            </span></span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-yarn-600 hover:bg-yarn-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors shadow-sm flex items-center gap-2"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">i</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"fa-solid fa-file-pdf"</span><span class="s3">&gt;&lt;/</span><span class="s6">i</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"hidden sm:inline"</span><span class="s3">&gt;</span><span class="s1">Upload Pattern</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"sm:hidden"</span><span class="s3">&gt;</span><span class="s1">Upload</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">&lt;!-- Toggle Ruler Button (Dark Mode) --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"toggleRulerBtn"</span><span class="s4"> </span><span class="s2">onclick</span><span class="s3">=</span><span class="s1">"toggleRuler()"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"p-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-gray-200 transition-colors shadow-sm"</span><span class="s4"> </span><span class="s2">title</span><span class="s3">=</span><span class="s1">"Toggle Line Marker"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                         </span></span><span class="s3">&lt;</span><span class="s6">i</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"fa-solid fa-ruler-horizontal"</span><span class="s3">&gt;&lt;/</span><span class="s6">i</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">&lt;!-- Remove Pattern Button --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"removePatternBtn"</span><span class="s4"> </span><span class="s2">onclick</span><span class="s3">=</span><span class="s1">"clearSavedPattern()"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"hidden text-red-500 hover:text-red-400 px-3 py-2 text-sm font-medium"</span><span class="s4"> </span><span class="s2">title</span><span class="s3">=</span><span class="s1">"Remove PDF Pattern"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">i</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"fa-solid fa-trash-can"</span><span class="s3">&gt;&lt;/</span><span class="s6">i</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">&lt;!-- Zoom Controls Group --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"zoomGroup"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex items-center gap-2 hidden"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"zoomOut"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"p-2 hover:bg-gray-700 rounded text-gray-300"</span><span class="s4"> </span><span class="s2">title</span><span class="s3">=</span><span class="s1">"Zoom Out"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s6">i</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"fa-solid fa-minus"</span><span class="s3">&gt;&lt;/</span><span class="s6">i</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xs text-gray-500 font-medium uppercase tracking-wide"</span><span class="s3">&gt;</span><span class="s4">Zoom</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"zoomIn"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"p-2 hover:bg-gray-700 rounded text-gray-300"</span><span class="s4"> </span><span class="s2">title</span><span class="s3">=</span><span class="s1">"Zoom In"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s6">i</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"fa-solid fa-plus"</span><span class="s3">&gt;&lt;/</span><span class="s6">i</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">&lt;!-- PDF Container (Kept Light) --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"pdfContainer"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex-1 overflow-auto flex p-4 relative bg-gray-50"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"emptyState"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"m-auto text-center text-gray-400"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">i</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"fa-solid fa-file-arrow-up text-6xl mb-4 text-gray-300"</span><span class="s3">&gt;&lt;/</span><span class="s6">i</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-lg text-gray-700"</span><span class="s3">&gt;</span><span class="s1">Upload a PDF pattern to begin</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-sm text-gray-500 mt-2"</span><span class="s3">&gt;</span><span class="s1">Pattern will be saved for next time</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"pdfLoader"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"hidden m-auto"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"loader"</span><span class="s3">&gt;&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-sm text-gray-500 mt-2 text-center"</span><span class="s3">&gt;</span><span class="s1">Loading stored pattern...</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"relative m-auto shadow-lg"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">canvas</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"the-canvas"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"block hidden bg-white"</span><span class="s3">&gt;&lt;/</span><span class="s6">canvas</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">&lt;!-- The ruler element will be injected here by JavaScript --&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">&lt;!-- Resizer Handle (Dark Mode) --&gt;</span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"resizer"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex-none bg-gray-700 flex justify-center items-center cursor-row-resize md:cursor-col-resize h-4 w-full md:w-4 md:h-full border-t md:border-t-0 md:border-l border-gray-600"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">i</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"fa-solid fa-grip-lines md:fa-grip-lines-vertical text-gray-300 text-xs"</span><span class="s3">&gt;&lt;/</span><span class="s6">i</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">&lt;!-- Row Counter Sidebar (Dark Mode) --&gt;</span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"sidebar"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-gray-800 flex-none flex flex-col shadow-xl z-20 relative"</span><span class="s4"> </span><span class="s2">style</span><span class="s3">=</span><span class="s1">"flex-basis: 320px;"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"p-4 bg-gray-900 border-b border-gray-700 flex-none"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">h2</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-yarn-400 font-semibold text-sm uppercase tracking-wider"</span><span class="s3">&gt;</span><span class="s4">Counters &amp; Notes</span><span class="s3">&lt;/</span><span class="s6">h2</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex-1 flex flex-col items-center justify-start p-6 gap-8 overflow-y-auto"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s7">&lt;!-- PRIMARY COUNTER: ROW --&gt;</span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"row-counter-group"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full text-center flex-none"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">h3</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xl font-semibold text-gray-300 mb-4"</span><span class="s3">&gt;</span><span class="s4">Row Counter</span><span class="s3">&lt;/</span><span class="s6">h3</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"relative group cursor-pointer inline-block"</span><span class="s4"> </span><span class="s2">onclick</span><span class="s3">=</span><span class="s1">"toggleEditMode('row')"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"rowCounterDisplay"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-7xl font-black text-gray-100 tabular-nums no-select"</span><span class="s3">&gt;</span><span class="s4">0</span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"number"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"rowCounterInput"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"hidden w-32 text-5xl text-center border-b-2 border-yarn-500 focus:outline-none bg-transparent"</span><span class="s4"> </span><span class="s2">value</span><span class="s3">=</span><span class="s1">"0"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"absolute -bottom-6 w-full text-center opacity-0 group-hover:opacity-100 transition-opacity text-xs text-yarn-400 font-medium"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>Tap to edit</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"grid grid-cols-2 gap-4 w-full max-w-[200px] mx-auto mt-4"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">data-counter</span><span class="s3">=</span><span class="s1">"row"</span><span class="s4"> </span><span class="s2">data-action</span><span class="s3">=</span><span class="s1">"dec"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"counter-btn-dec no-select h-16 w-full bg-gray-700 hover:bg-gray-600 active:bg-gray-500 text-gray-300 rounded-xl shadow-sm text-2xl transition-all active:scale-95 flex items-center justify-center"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s6">i</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"fa-solid fa-minus"</span><span class="s3">&gt;&lt;/</span><span class="s6">i</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">data-counter</span><span class="s3">=</span><span class="s1">"row"</span><span class="s4"> </span><span class="s2">data-action</span><span class="s3">=</span><span class="s1">"inc"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"counter-btn-inc no-select h-16 w-full bg-yarn-600 hover:bg-yarn-700 active:bg-yarn-800 text-white rounded-xl shadow-lg shadow-yarn-500/30 text-2xl transition-all active:scale-95 flex items-center justify-center"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s6">i</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"fa-solid fa-plus"</span><span class="s3">&gt;&lt;/</span><span class="s6">i</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s7">&lt;!-- SECONDARY COUNTER: REPEAT/UNLABELED --&gt;</span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"repeat-counter-group"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full text-center border-t pt-8 border-gray-700 mt-4 flex-none"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">h3</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xl font-semibold text-gray-300 mb-4"</span><span class="s3">&gt;</span><span class="s4">Repeat Counter</span><span class="s3">&lt;/</span><span class="s6">h3</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"relative group cursor-pointer inline-block"</span><span class="s4"> </span><span class="s2">onclick</span><span class="s3">=</span><span class="s1">"toggleEditMode('repeat')"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"repeatCounterDisplay"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-7xl font-black text-gray-100 tabular-nums no-select"</span><span class="s3">&gt;</span><span class="s4">0</span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"number"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"repeatCounterInput"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"hidden w-32 text-5xl text-center border-b-2 border-yarn-500 focus:outline-none bg-transparent"</span><span class="s4"> </span><span class="s2">value</span><span class="s3">=</span><span class="s1">"0"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"absolute -bottom-6 w-full text-center opacity-0 group-hover:opacity-100 transition-opacity text-xs text-yarn-400 font-medium"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span>Tap to edit</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"grid grid-cols-2 gap-4 w-full max-w-[200px] mx-auto mt-4"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">data-counter</span><span class="s3">=</span><span class="s1">"repeat"</span><span class="s4"> </span><span class="s2">data-action</span><span class="s3">=</span><span class="s1">"dec"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"counter-btn-dec no-select h-16 w-full bg-gray-700 hover:bg-gray-600 active:bg-gray-500 text-gray-300 rounded-xl shadow-sm text-2xl transition-all active:scale-95 flex items-center justify-center"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s6">i</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"fa-solid fa-minus"</span><span class="s3">&gt;&lt;/</span><span class="s6">i</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">data-counter</span><span class="s3">=</span><span class="s1">"repeat"</span><span class="s4"> </span><span class="s2">data-action</span><span class="s3">=</span><span class="s1">"inc"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"counter-btn-inc no-select h-16 w-full bg-yarn-600 hover:bg-yarn-700 active:bg-yarn-800 text-white rounded-xl shadow-lg shadow-yarn-500/30 text-2xl transition-all active:scale-95 flex items-center justify-center"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                            </span></span><span class="s3">&lt;</span><span class="s6">i</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"fa-solid fa-plus"</span><span class="s3">&gt;&lt;/</span><span class="s6">i</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">&lt;!-- NOTES PAD (Dark Mode) --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"notes-group"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full text-left border-t pt-8 border-gray-700 mt-4 flex-1"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">h3</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xl font-semibold text-gray-300 mb-4"</span><span class="s3">&gt;</span><span class="s4">Pattern Notes</span><span class="s3">&lt;/</span><span class="s6">h3</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">textarea</span><span class="s1"> </span><span class="s2">id</span><span class="s3">=</span><span class="s5">"notesPad"</span><span class="s1"> </span><span class="s2">rows</span><span class="s3">=</span><span class="s5">"8"</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full p-3 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yarn-500 focus:border-yarn-500 text-sm resize-y min-h-[100px] transition-shadow bg-gray-700 text-gray-100 placeholder-gray-400"</span><span class="s4"><span class="Apple-converted-space"> </span></span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s2">placeholder</span><span class="s3">=</span><span class="s1">"Jot down notes about yarn, needles, size, or pattern modifications..."</span><span class="s3">&gt;&lt;/</span><span class="s6">textarea</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"p-4 border-t border-gray-700 bg-gray-900 flex-none relative"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"file"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"fileInput"</span><span class="s4"> </span><span class="s2">accept</span><span class="s3">=</span><span class="s1">"application/pdf"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"hidden"</span><span class="s4"> </span><span class="s3">/&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">&lt;!-- Confirmation Modal (Dark Mode) --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"confirmResetOverlay"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"absolute inset-0 bg-gray-800/95 backdrop-blur-sm z-50 hidden flex flex-col items-center justify-center p-8"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-lg font-semibold mb-6 text-gray-100"</span><span class="s3">&gt;</span><span class="s4">Are you sure?</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-center text-sm mb-8 text-gray-300"</span><span class="s3">&gt;</span><span class="s1">This will reset both Row and Repeat counters to 0 permanently.</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"flex gap-4"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"cancelReset"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"px-6 py-2 border border-gray-600 rounded-lg text-gray-300 hover:bg-gray-700 transition"</span><span class="s3">&gt;</span><span class="s4">Cancel</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                        </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"confirmReset"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"px-6 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition shadow-md"</span><span class="s3">&gt;</span><span class="s4">Reset Counters</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">&lt;!-- End Confirmation Modal --&gt;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">onclick</span><span class="s3">=</span><span class="s1">"resetAllCounters()"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full py-3 text-sm font-medium text-gray-400 hover:text-red-400 hover:bg-red-900/50 rounded-lg transition-colors flex items-center justify-center gap-2 mb-2"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">&lt;</span><span class="s6">i</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"fa-solid fa-rotate-right"</span><span class="s3">&gt;&lt;/</span><span class="s6">i</span><span class="s3">&gt;</span><span class="s1"> Reset Both Counters</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xs text-center text-gray-500 mt-2"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>Counters &amp; Pattern auto-save</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">main</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- IndexedDB Logic (For Saving PDFs) ---</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s12">const</span><span class="s4"> </span><span class="s13">DB_NAME</span><span class="s4"> </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'KnitCountDB'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">const</span><span class="s1"> </span><span class="s13">STORE_NAME</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'patterns'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">const</span><span class="s1"> </span><span class="s13">DB_VERSION</span><span class="s1"> </span><span class="s8">=</span><span class="s1"> </span><span class="s9">1</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> openDB</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">return</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s13">Promise</span><span class="s8">((</span><span class="s1">resolve</span><span class="s8">,</span><span class="s1"> reject</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> request </span><span class="s8">=</span><span class="s1"> indexedDB</span><span class="s8">.</span><span class="s1">open</span><span class="s8">(</span><span class="s13">DB_NAME</span><span class="s8">,</span><span class="s1"> </span><span class="s13">DB_VERSION</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>request</span><span class="s8">.</span><span class="s1">onerror </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> reject</span><span class="s8">(</span><span class="s10">"DB Error"</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>request</span><span class="s8">.</span><span class="s1">onupgradeneeded </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">const</span><span class="s1"> db </span><span class="s8">=</span><span class="s1"> e</span><span class="s8">.</span><span class="s1">target</span><span class="s8">.</span><span class="s1">result</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">db</span><span class="s8">.</span><span class="s1">objectStoreNames</span><span class="s8">.</span><span class="s1">contains</span><span class="s8">(</span><span class="s13">STORE_NAME</span><span class="s8">))</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>db</span><span class="s8">.</span><span class="s1">createObjectStore</span><span class="s8">(</span><span class="s13">STORE_NAME</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>request</span><span class="s8">.</span><span class="s1">onsuccess </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> resolve</span><span class="s8">(</span><span class="s1">e</span><span class="s8">.</span><span class="s1">target</span><span class="s8">.</span><span class="s1">result</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">async</span><span class="s1"> </span><span class="s12">function</span><span class="s1"> savePDFToDB</span><span class="s8">(</span><span class="s1">file</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> db </span><span class="s8">=</span><span class="s1"> </span><span class="s12">await</span><span class="s1"> openDB</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> tx </span><span class="s8">=</span><span class="s1"> db</span><span class="s8">.</span><span class="s1">transaction</span><span class="s8">(</span><span class="s13">STORE_NAME</span><span class="s8">,</span><span class="s1"> </span><span class="s10">'readwrite'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> store </span><span class="s8">=</span><span class="s1"> tx</span><span class="s8">.</span><span class="s1">objectStore</span><span class="s8">(</span><span class="s13">STORE_NAME</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>store</span><span class="s8">.</span><span class="s1">put</span><span class="s8">(</span><span class="s1">file</span><span class="s8">,</span><span class="s1"> </span><span class="s10">'currentPattern'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">return</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s13">Promise</span><span class="s8">((</span><span class="s1">resolve</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>tx</span><span class="s8">.</span><span class="s1">oncomplete </span><span class="s8">=</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> resolve</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">async</span><span class="s1"> </span><span class="s12">function</span><span class="s1"> getPDFFromDB</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> db </span><span class="s8">=</span><span class="s1"> </span><span class="s12">await</span><span class="s1"> openDB</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> tx </span><span class="s8">=</span><span class="s1"> db</span><span class="s8">.</span><span class="s1">transaction</span><span class="s8">(</span><span class="s13">STORE_NAME</span><span class="s8">,</span><span class="s1"> </span><span class="s10">'readonly'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> store </span><span class="s8">=</span><span class="s1"> tx</span><span class="s8">.</span><span class="s1">objectStore</span><span class="s8">(</span><span class="s13">STORE_NAME</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> request </span><span class="s8">=</span><span class="s1"> store</span><span class="s8">.</span><span class="s12">get</span><span class="s8">(</span><span class="s10">'currentPattern'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">return</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s13">Promise</span><span class="s8">((</span><span class="s1">resolve</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>request</span><span class="s8">.</span><span class="s1">onsuccess </span><span class="s8">=</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> resolve</span><span class="s8">(</span><span class="s1">request</span><span class="s8">.</span><span class="s1">result</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>request</span><span class="s8">.</span><span class="s1">onerror </span><span class="s8">=</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> resolve</span><span class="s8">(</span><span class="s12">null</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">async</span><span class="s1"> </span><span class="s12">function</span><span class="s1"> clearPDFFromDB</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> db </span><span class="s8">=</span><span class="s1"> </span><span class="s12">await</span><span class="s1"> openDB</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> tx </span><span class="s8">=</span><span class="s1"> db</span><span class="s8">.</span><span class="s1">transaction</span><span class="s8">(</span><span class="s13">STORE_NAME</span><span class="s8">,</span><span class="s1"> </span><span class="s10">'readwrite'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> store </span><span class="s8">=</span><span class="s1"> tx</span><span class="s8">.</span><span class="s1">objectStore</span><span class="s8">(</span><span class="s13">STORE_NAME</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>store</span><span class="s8">.</span><span class="s12">delete</span><span class="s8">(</span><span class="s10">'currentPattern'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">return</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s13">Promise</span><span class="s8">((</span><span class="s1">resolve</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>tx</span><span class="s8">.</span><span class="s1">oncomplete </span><span class="s8">=</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> resolve</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- State Management and Counter Logic ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">let</span><span class="s1"> rowCount </span><span class="s8">=</span><span class="s1"> </span><span class="s9">0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">let</span><span class="s1"> repeatCount </span><span class="s8">=</span><span class="s1"> </span><span class="s9">0</span><span class="s8">;</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s12">const</span><span class="s4"> </span><span class="s13">ROW_KEY</span><span class="s4"> </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'knitCount_row'</span><span class="s8">;</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s12">const</span><span class="s4"> </span><span class="s13">REPEAT_KEY</span><span class="s4"> </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'knitCount_repeat'</span><span class="s8">;</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s12">const</span><span class="s4"> </span><span class="s13">NOTES_KEY</span><span class="s4"> </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'knitCount_notes'</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Ruler State ---</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s12">const</span><span class="s4"> </span><span class="s13">RULER_STATE_KEY</span><span class="s4"> </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'knitCount_ruler_state'</span><span class="s8">;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s12">const</span><span class="s4"> </span><span class="s13">RULER_POSITION_KEY</span><span class="s4"> </span><span class="s8">=</span><span class="s4"> </span><span class="s10">'knitCount_ruler_pos'</span><span class="s8">;</span><span class="s4"> </span><span class="s1">// Vertical position (percentage from top)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">let</span><span class="s1"> isRulerEnabled </span><span class="s8">=</span><span class="s1"> </span><span class="s12">false</span><span class="s8">;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s12">let</span><span class="s4"> rulerY </span><span class="s8">=</span><span class="s4"> </span><span class="s9">50</span><span class="s8">;</span><span class="s4"> </span><span class="s1">// Default vertical position (50% of container height)</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">        </span>pdfjsLib</span><span class="s8">.</span><span class="s13">GlobalWorkerOptions</span><span class="s8">.</span><span class="s4">workerSrc </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js'</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">let</span><span class="s1"> pdfDoc </span><span class="s8">=</span><span class="s1"> </span><span class="s12">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">let</span><span class="s1"> pageNum </span><span class="s8">=</span><span class="s1"> </span><span class="s9">1</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">let</span><span class="s1"> pageRendering </span><span class="s8">=</span><span class="s1"> </span><span class="s12">false</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">let</span><span class="s1"> pageNumPending </span><span class="s8">=</span><span class="s1"> </span><span class="s12">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">let</span><span class="s1"> scale </span><span class="s8">=</span><span class="s1"> </span><span class="s9">1.0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">const</span><span class="s1"> canvas </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'the-canvas'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">const</span><span class="s1"> ctx </span><span class="s8">=</span><span class="s1"> canvas</span><span class="s8">.</span><span class="s1">getContext</span><span class="s8">(</span><span class="s10">'2d'</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Initialization ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>window</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'load'</span><span class="s8">,</span><span class="s1"> </span><span class="s12">async</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>loadAllCounters</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>loadNotes</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>setupEventListeners</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>setupResizer</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>setupRuler</span><span class="s8">();</span><span class="s1"> </span><span class="s7">// Initialize ruler</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Check for saved PDF</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'pdfLoader'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">try</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> savedFile </span><span class="s8">=</span><span class="s1"> </span><span class="s12">await</span><span class="s1"> getPDFFromDB</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">savedFile</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>loadPDF</span><span class="s8">(</span><span class="s1">savedFile</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span><span class="s1"> </span><span class="s12">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'pdfLoader'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'emptyState'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s12">catch</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>console</span><span class="s8">.</span><span class="s1">error</span><span class="s8">(</span><span class="s10">"Error loading PDF"</span><span class="s8">,</span><span class="s1"> e</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'pdfLoader'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'emptyState'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">});</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> setupResizer</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> resizer </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'resizer'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> sidebar </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'sidebar'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> mainContainer </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'mainContainer'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">let</span><span class="s1"> isResizing </span><span class="s8">=</span><span class="s1"> </span><span class="s12">false</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>resizer</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'mousedown'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>isResizing </span><span class="s8">=</span><span class="s1"> </span><span class="s12">true</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>resizer</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s10">'active'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">body</span><span class="s8">.</span><span class="s1">style</span><span class="s8">.</span><span class="s1">cursor </span><span class="s8">=</span><span class="s1"> window</span><span class="s8">.</span><span class="s1">innerWidth </span><span class="s8">&gt;=</span><span class="s1"> </span><span class="s9">768</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> </span><span class="s10">'col-resize'</span><span class="s1"> </span><span class="s8">:</span><span class="s1"> </span><span class="s10">'row-resize'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>e</span><span class="s8">.</span><span class="s1">preventDefault</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'mousemove'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">isResizing</span><span class="s8">)</span><span class="s1"> </span><span class="s12">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> isDesktop </span><span class="s8">=</span><span class="s1"> window</span><span class="s8">.</span><span class="s1">innerWidth </span><span class="s8">&gt;=</span><span class="s1"> </span><span class="s9">768</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> containerRect </span><span class="s8">=</span><span class="s1"> mainContainer</span><span class="s8">.</span><span class="s1">getBoundingClientRect</span><span class="s8">();</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">isDesktop</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">let</span><span class="s1"> newWidth </span><span class="s8">=</span><span class="s1"> containerRect</span><span class="s8">.</span><span class="s1">right </span><span class="s8">-</span><span class="s1"> e</span><span class="s8">.</span><span class="s1">clientX</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">newWidth </span><span class="s8">&lt;</span><span class="s1"> </span><span class="s9">200</span><span class="s8">)</span><span class="s1"> newWidth </span><span class="s8">=</span><span class="s1"> </span><span class="s9">200</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">newWidth </span><span class="s8">&gt;</span><span class="s1"> containerRect</span><span class="s8">.</span><span class="s1">width </span><span class="s8">*</span><span class="s1"> </span><span class="s9">0.6</span><span class="s8">)</span><span class="s1"> newWidth </span><span class="s8">=</span><span class="s1"> containerRect</span><span class="s8">.</span><span class="s1">width </span><span class="s8">*</span><span class="s1"> </span><span class="s9">0.6</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>sidebar</span><span class="s8">.</span><span class="s1">style</span><span class="s8">.</span><span class="s1">flexBasis </span><span class="s8">=</span><span class="s1"> </span><span class="s10">`</span><span class="s8">${</span><span class="s1">newWidth</span><span class="s8">}</span><span class="s10">px`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>sidebar</span><span class="s8">.</span><span class="s1">style</span><span class="s8">.</span><span class="s1">height </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'auto'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span><span class="s1"> </span><span class="s12">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">let</span><span class="s1"> newHeight </span><span class="s8">=</span><span class="s1"> containerRect</span><span class="s8">.</span><span class="s1">bottom </span><span class="s8">-</span><span class="s1"> e</span><span class="s8">.</span><span class="s1">clientY</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">newHeight </span><span class="s8">&lt;</span><span class="s1"> </span><span class="s9">150</span><span class="s8">)</span><span class="s1"> newHeight </span><span class="s8">=</span><span class="s1"> </span><span class="s9">150</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">newHeight </span><span class="s8">&gt;</span><span class="s1"> containerRect</span><span class="s8">.</span><span class="s1">height </span><span class="s8">*</span><span class="s1"> </span><span class="s9">0.7</span><span class="s8">)</span><span class="s1"> newHeight </span><span class="s8">=</span><span class="s1"> containerRect</span><span class="s8">.</span><span class="s1">height </span><span class="s8">*</span><span class="s1"> </span><span class="s9">0.7</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>sidebar</span><span class="s8">.</span><span class="s1">style</span><span class="s8">.</span><span class="s1">flexBasis </span><span class="s8">=</span><span class="s1"> </span><span class="s10">`</span><span class="s8">${</span><span class="s1">newHeight</span><span class="s8">}</span><span class="s10">px`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>sidebar</span><span class="s8">.</span><span class="s1">style</span><span class="s8">.</span><span class="s1">width </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'auto'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> stopResize </span><span class="s8">=</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s8">(</span><span class="s1">isResizing</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>isResizing </span><span class="s8">=</span><span class="s1"> </span><span class="s12">false</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>resizer</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s10">'active'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>document</span><span class="s8">.</span><span class="s1">body</span><span class="s8">.</span><span class="s1">style</span><span class="s8">.</span><span class="s1">cursor </span><span class="s8">=</span><span class="s1"> </span><span class="s10">''</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'mouseup'</span><span class="s8">,</span><span class="s1"> stopResize</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>resizer</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'touchstart'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> isResizing </span><span class="s8">=</span><span class="s1"> </span><span class="s12">true</span><span class="s8">;</span><span class="s1"> resizer</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s10">'active'</span><span class="s8">);</span><span class="s1"> </span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'touchmove'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">isResizing</span><span class="s8">)</span><span class="s1"> </span><span class="s12">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> touch </span><span class="s8">=</span><span class="s1"> e</span><span class="s8">.</span><span class="s1">touches</span><span class="s8">[</span><span class="s9">0</span><span class="s8">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> isDesktop </span><span class="s8">=</span><span class="s1"> window</span><span class="s8">.</span><span class="s1">innerWidth </span><span class="s8">&gt;=</span><span class="s1"> </span><span class="s9">768</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> containerRect </span><span class="s8">=</span><span class="s1"> mainContainer</span><span class="s8">.</span><span class="s1">getBoundingClientRect</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">isDesktop</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">let</span><span class="s1"> newHeight </span><span class="s8">=</span><span class="s1"> containerRect</span><span class="s8">.</span><span class="s1">bottom </span><span class="s8">-</span><span class="s1"> touch</span><span class="s8">.</span><span class="s1">clientY</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">newHeight </span><span class="s8">&lt;</span><span class="s1"> </span><span class="s9">150</span><span class="s8">)</span><span class="s1"> newHeight </span><span class="s8">=</span><span class="s1"> </span><span class="s9">150</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">newHeight </span><span class="s8">&gt;</span><span class="s1"> containerRect</span><span class="s8">.</span><span class="s1">height </span><span class="s8">*</span><span class="s1"> </span><span class="s9">0.7</span><span class="s8">)</span><span class="s1"> newHeight </span><span class="s8">=</span><span class="s1"> containerRect</span><span class="s8">.</span><span class="s1">height </span><span class="s8">*</span><span class="s1"> </span><span class="s9">0.7</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>sidebar</span><span class="s8">.</span><span class="s1">style</span><span class="s8">.</span><span class="s1">flexBasis </span><span class="s8">=</span><span class="s1"> </span><span class="s10">`</span><span class="s8">${</span><span class="s1">newHeight</span><span class="s8">}</span><span class="s10">px`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'touchend'</span><span class="s8">,</span><span class="s1"> stopResize</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Confirmation Modal Logic ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> showResetConfirm</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'confirmResetOverlay'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> hideResetConfirm</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'confirmResetOverlay'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> executeReset</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>updateCounter</span><span class="s8">(</span><span class="s10">'row'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">0</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>updateCounter</span><span class="s8">(</span><span class="s10">'repeat'</span><span class="s8">,</span><span class="s1"> </span><span class="s9">0</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>hideResetConfirm</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> setupEventListeners</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Counter buttons (using event delegation for simplicity)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'sidebar'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'click'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> button </span><span class="s8">=</span><span class="s1"> e</span><span class="s8">.</span><span class="s1">target</span><span class="s8">.</span><span class="s1">closest</span><span class="s8">(</span><span class="s10">'button[data-counter]'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">button</span><span class="s8">)</span><span class="s1"> </span><span class="s12">return</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> counterType </span><span class="s8">=</span><span class="s1"> button</span><span class="s8">.</span><span class="s1">getAttribute</span><span class="s8">(</span><span class="s10">'data-counter'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> action </span><span class="s8">=</span><span class="s1"> button</span><span class="s8">.</span><span class="s1">getAttribute</span><span class="s8">(</span><span class="s10">'data-action'</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">let</span><span class="s1"> currentCount </span><span class="s8">=</span><span class="s1"> counterType </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'row'</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> rowCount </span><span class="s8">:</span><span class="s1"> repeatCount</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">let</span><span class="s1"> newCount </span><span class="s8">=</span><span class="s1"> currentCount</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">action </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'inc'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>newCount</span><span class="s8">++;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span><span class="s1"> </span><span class="s12">else</span><span class="s1"> </span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">action </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'dec'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>newCount </span><span class="s8">=</span><span class="s1"> </span><span class="s13">Math</span><span class="s8">.</span><span class="s1">max</span><span class="s8">(</span><span class="s9">0</span><span class="s8">,</span><span class="s1"> currentCount </span><span class="s8">-</span><span class="s1"> </span><span class="s9">1</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>updateCounter</span><span class="s8">(</span><span class="s1">counterType</span><span class="s8">,</span><span class="s1"> newCount</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Confirmation modal listeners</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'cancelReset'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'click'</span><span class="s8">,</span><span class="s1"> hideResetConfirm</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'confirmReset'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'click'</span><span class="s8">,</span><span class="s1"> executeReset</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Input event listeners (row)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> rowInput </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'rowCounterInput'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>rowInput</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'blur'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> finishEdit</span><span class="s8">(</span><span class="s10">'row'</span><span class="s8">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>rowInput</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'keydown'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">.</span><span class="s1">key </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'Enter'</span><span class="s8">)</span><span class="s1"> finishEdit</span><span class="s8">(</span><span class="s10">'row'</span><span class="s8">);</span><span class="s1"> </span><span class="s8">});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Input event listeners (repeat)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> repeatInput </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'repeatCounterInput'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>repeatInput</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'blur'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> finishEdit</span><span class="s8">(</span><span class="s10">'repeat'</span><span class="s8">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>repeatInput</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'keydown'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">.</span><span class="s1">key </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'Enter'</span><span class="s8">)</span><span class="s1"> finishEdit</span><span class="s8">(</span><span class="s10">'repeat'</span><span class="s8">);</span><span class="s1"> </span><span class="s8">});</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Notes listener (save notes on every input)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'notesPad'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'input'</span><span class="s8">,</span><span class="s1"> saveNotes</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// PDF/Page listeners</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'fileInput'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'change'</span><span class="s8">,</span><span class="s1"> handleFileUpload</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'prevPage'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'click'</span><span class="s8">,</span><span class="s1"> onPrevPage</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'nextPage'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'click'</span><span class="s8">,</span><span class="s1"> onNextPage</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'zoomIn'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'click'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> scale </span><span class="s8">+=</span><span class="s1"> </span><span class="s9">0.25</span><span class="s8">;</span><span class="s1"> queueRenderPage</span><span class="s8">(</span><span class="s1">pageNum</span><span class="s8">);</span><span class="s1"> </span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'zoomOut'</span><span class="s8">).</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'click'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> </span><span class="s12">if</span><span class="s8">(</span><span class="s1">scale </span><span class="s8">&gt;</span><span class="s1"> </span><span class="s9">0.3</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> scale </span><span class="s8">-=</span><span class="s1"> </span><span class="s9">0.25</span><span class="s8">;</span><span class="s1"> queueRenderPage</span><span class="s8">(</span><span class="s1">pageNum</span><span class="s8">);</span><span class="s1"> </span><span class="s8">}</span><span class="s1"> </span><span class="s8">});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Keyboard shortcuts (only for Row Counter)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'keydown'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">document</span><span class="s8">.</span><span class="s1">activeElement</span><span class="s8">.</span><span class="s1">tagName </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'INPUT'</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">activeElement</span><span class="s8">.</span><span class="s1">tagName </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'TEXTAREA'</span><span class="s8">)</span><span class="s1"> </span><span class="s12">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">.</span><span class="s1">code </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'ArrowUp'</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> e</span><span class="s8">.</span><span class="s1">code </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'ArrowRight'</span><span class="s8">)</span><span class="s1"> updateCounter</span><span class="s8">(</span><span class="s10">'row'</span><span class="s8">,</span><span class="s1"> rowCount </span><span class="s8">+</span><span class="s1"> </span><span class="s9">1</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">.</span><span class="s1">code </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'ArrowDown'</span><span class="s1"> </span><span class="s8">||</span><span class="s1"> e</span><span class="s8">.</span><span class="s1">code </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'ArrowLeft'</span><span class="s8">)</span><span class="s1"> updateCounter</span><span class="s8">(</span><span class="s10">'row'</span><span class="s8">,</span><span class="s1"> rowCount </span><span class="s8">-</span><span class="s1"> </span><span class="s9">1</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> updateCounter</span><span class="s8">(</span><span class="s1">type</span><span class="s8">,</span><span class="s1"> newVal</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">newVal </span><span class="s8">&lt;</span><span class="s1"> </span><span class="s9">0</span><span class="s8">)</span><span class="s1"> newVal </span><span class="s8">=</span><span class="s1"> </span><span class="s9">0</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">let</span><span class="s1"> display</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">let</span><span class="s1"> key</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">type </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'row'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>rowCount </span><span class="s8">=</span><span class="s1"> newVal</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>display </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'rowCounterDisplay'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>key </span><span class="s8">=</span><span class="s1"> </span><span class="s13">ROW_KEY</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s12">else</span><span class="s1"> </span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">type </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'repeat'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>repeatCount </span><span class="s8">=</span><span class="s1"> newVal</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>display </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'repeatCounterDisplay'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>key </span><span class="s8">=</span><span class="s1"> </span><span class="s13">REPEAT_KEY</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span><span class="s1"> </span><span class="s12">else</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s12">return</span><span class="s8">;</span><span class="s4"> </span><span class="s1">// Invalid counter type</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>display</span><span class="s8">.</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> newVal</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>localStorage</span><span class="s8">.</span><span class="s1">setItem</span><span class="s8">(</span><span class="s1">key</span><span class="s8">,</span><span class="s1"> newVal</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Simple click feedback animation</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>display</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s10">'scale-110'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">void</span><span class="s1"> display</span><span class="s8">.</span><span class="s1">offsetWidth</span><span class="s8">;</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span>display</span><span class="s8">.</span><span class="s4">classList</span><span class="s8">.</span><span class="s4">add</span><span class="s8">(</span><span class="s1">'scale-110'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'transition-transform'</span><span class="s8">,</span><span class="s4"> </span><span class="s1">'duration-100'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>setTimeout</span><span class="s8">(()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> display</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s10">'scale-110'</span><span class="s8">),</span><span class="s1"> </span><span class="s9">100</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> resetAllCounters</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>showResetConfirm</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> toggleEditMode</span><span class="s8">(</span><span class="s1">type</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> display </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">`</span><span class="s8">${</span><span class="s1">type</span><span class="s8">}</span><span class="s10">CounterDisplay`</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> input </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">`</span><span class="s8">${</span><span class="s1">type</span><span class="s8">}</span><span class="s10">CounterInput`</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> currentValue </span><span class="s8">=</span><span class="s1"> type </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'row'</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> rowCount </span><span class="s8">:</span><span class="s1"> repeatCount</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>input</span><span class="s8">.</span><span class="s1">value </span><span class="s8">=</span><span class="s1"> currentValue</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>display</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>input</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>input</span><span class="s8">.</span><span class="s1">focus</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>input</span><span class="s8">.</span><span class="s1">select</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> finishEdit</span><span class="s8">(</span><span class="s1">type</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> display </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">`</span><span class="s8">${</span><span class="s1">type</span><span class="s8">}</span><span class="s10">CounterDisplay`</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> input </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">`</span><span class="s8">${</span><span class="s1">type</span><span class="s8">}</span><span class="s10">CounterInput`</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">let</span><span class="s1"> val </span><span class="s8">=</span><span class="s1"> parseInt</span><span class="s8">(</span><span class="s1">input</span><span class="s8">.</span><span class="s1">value</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">isNaN</span><span class="s8">(</span><span class="s1">val</span><span class="s8">))</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>val </span><span class="s8">=</span><span class="s1"> type </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'row'</span><span class="s1"> </span><span class="s8">?</span><span class="s1"> rowCount </span><span class="s8">:</span><span class="s1"> repeatCount</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>updateCounter</span><span class="s8">(</span><span class="s1">type</span><span class="s8">,</span><span class="s1"> val</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>input</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>display</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> loadAllCounters</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Load Row Counter</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> savedRow </span><span class="s8">=</span><span class="s1"> localStorage</span><span class="s8">.</span><span class="s1">getItem</span><span class="s8">(</span><span class="s13">ROW_KEY</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">savedRow </span><span class="s8">!==</span><span class="s1"> </span><span class="s12">null</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>rowCount </span><span class="s8">=</span><span class="s1"> parseInt</span><span class="s8">(</span><span class="s1">savedRow</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'rowCounterDisplay'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> rowCount</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Load Repeat Counter</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> savedRepeat </span><span class="s8">=</span><span class="s1"> localStorage</span><span class="s8">.</span><span class="s1">getItem</span><span class="s8">(</span><span class="s13">REPEAT_KEY</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">savedRepeat </span><span class="s8">!==</span><span class="s1"> </span><span class="s12">null</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>repeatCount </span><span class="s8">=</span><span class="s1"> parseInt</span><span class="s8">(</span><span class="s1">savedRepeat</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'repeatCounterDisplay'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> repeatCount</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Notes Logic ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> saveNotes</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> notes </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'notesPad'</span><span class="s8">).</span><span class="s1">value</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>localStorage</span><span class="s8">.</span><span class="s1">setItem</span><span class="s8">(</span><span class="s13">NOTES_KEY</span><span class="s8">,</span><span class="s1"> notes</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> loadNotes</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> notesPad </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'notesPad'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> savedNotes </span><span class="s8">=</span><span class="s1"> localStorage</span><span class="s8">.</span><span class="s1">getItem</span><span class="s8">(</span><span class="s13">NOTES_KEY</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">savedNotes </span><span class="s8">!==</span><span class="s1"> </span><span class="s12">null</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>notesPad</span><span class="s8">.</span><span class="s1">value </span><span class="s8">=</span><span class="s1"> savedNotes</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// -------------------</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Ruler Logic (New) ---</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> setupRuler</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Inject ruler HTML</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> pdfContainer </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'pdfContainer'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> ruler </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">createElement</span><span class="s8">(</span><span class="s10">'div'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>ruler</span><span class="s8">.</span><span class="s1">id </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'ruler'</span><span class="s8">;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Tailwind classes for the ruler</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span>ruler</span><span class="s8">.</span><span class="s4">className </span><span class="s8">=</span><span class="s4"> </span><span class="s1">'absolute left-0 right-0 h-4 bg-red-400 opacity-50 cursor-move border-y-2 border-red-600 shadow-xl transition-opacity z-40 hidden'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>pdfContainer</span><span class="s8">.</span><span class="s1">appendChild</span><span class="s8">(</span><span class="s1">ruler</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>loadRulerState</span><span class="s8">();</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Drag logic</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">let</span><span class="s1"> isDragging </span><span class="s8">=</span><span class="s1"> </span><span class="s12">false</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">let</span><span class="s1"> startY</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">let</span><span class="s1"> startRulerY</span><span class="s8">;</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>ruler</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'mousedown'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">isRulerEnabled</span><span class="s8">)</span><span class="s1"> </span><span class="s12">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>isDragging </span><span class="s8">=</span><span class="s1"> </span><span class="s12">true</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>ruler</span><span class="s8">.</span><span class="s1">style</span><span class="s8">.</span><span class="s1">cursor </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'grabbing'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>startY </span><span class="s8">=</span><span class="s1"> e</span><span class="s8">.</span><span class="s1">clientY</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>startRulerY </span><span class="s8">=</span><span class="s1"> ruler</span><span class="s8">.</span><span class="s1">offsetTop</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>e</span><span class="s8">.</span><span class="s1">preventDefault</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'mousemove'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">isDragging</span><span class="s8">)</span><span class="s1"> </span><span class="s12">return</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> pdfRect </span><span class="s8">=</span><span class="s1"> pdfContainer</span><span class="s8">.</span><span class="s1">getBoundingClientRect</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> deltaY </span><span class="s8">=</span><span class="s1"> e</span><span class="s8">.</span><span class="s1">clientY </span><span class="s8">-</span><span class="s1"> startY</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">let</span><span class="s1"> newTop </span><span class="s8">=</span><span class="s1"> startRulerY </span><span class="s8">+</span><span class="s1"> deltaY</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> maxTop </span><span class="s8">=</span><span class="s1"> pdfRect</span><span class="s8">.</span><span class="s1">height </span><span class="s8">-</span><span class="s1"> ruler</span><span class="s8">.</span><span class="s1">offsetHeight</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>newTop </span><span class="s8">=</span><span class="s1"> </span><span class="s13">Math</span><span class="s8">.</span><span class="s1">max</span><span class="s8">(</span><span class="s9">0</span><span class="s8">,</span><span class="s1"> </span><span class="s13">Math</span><span class="s8">.</span><span class="s1">min</span><span class="s8">(</span><span class="s1">newTop</span><span class="s8">,</span><span class="s1"> maxTop</span><span class="s8">));</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>ruler</span><span class="s8">.</span><span class="s1">style</span><span class="s8">.</span><span class="s1">top </span><span class="s8">=</span><span class="s1"> </span><span class="s10">`</span><span class="s8">${</span><span class="s1">newTop</span><span class="s8">}</span><span class="s10">px`</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Calculate and save position as a percentage</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>rulerY </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">newTop </span><span class="s8">/</span><span class="s1"> </span><span class="s8">(</span><span class="s1">pdfRect</span><span class="s8">.</span><span class="s1">height </span><span class="s8">-</span><span class="s1"> ruler</span><span class="s8">.</span><span class="s1">offsetHeight</span><span class="s8">))</span><span class="s1"> </span><span class="s8">*</span><span class="s1"> </span><span class="s9">100</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'mouseup'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">isDragging</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>isDragging </span><span class="s8">=</span><span class="s1"> </span><span class="s12">false</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>ruler</span><span class="s8">.</span><span class="s1">style</span><span class="s8">.</span><span class="s1">cursor </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'move'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>saveRulerState</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Add touch support</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>ruler</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'touchstart'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">isRulerEnabled</span><span class="s8">)</span><span class="s1"> </span><span class="s12">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>isDragging </span><span class="s8">=</span><span class="s1"> </span><span class="s12">true</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>ruler</span><span class="s8">.</span><span class="s1">style</span><span class="s8">.</span><span class="s1">cursor </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'grabbing'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>startY </span><span class="s8">=</span><span class="s1"> e</span><span class="s8">.</span><span class="s1">touches</span><span class="s8">[</span><span class="s9">0</span><span class="s8">].</span><span class="s1">clientY</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>startRulerY </span><span class="s8">=</span><span class="s1"> ruler</span><span class="s8">.</span><span class="s1">offsetTop</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>e</span><span class="s8">.</span><span class="s1">preventDefault</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">},</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> passive</span><span class="s8">:</span><span class="s1"> </span><span class="s12">false</span><span class="s1"> </span><span class="s8">});</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'touchmove'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">isDragging </span><span class="s8">||</span><span class="s1"> e</span><span class="s8">.</span><span class="s1">touches</span><span class="s8">.</span><span class="s1">length </span><span class="s8">===</span><span class="s1"> </span><span class="s9">0</span><span class="s8">)</span><span class="s1"> </span><span class="s12">return</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> touch </span><span class="s8">=</span><span class="s1"> e</span><span class="s8">.</span><span class="s1">touches</span><span class="s8">[</span><span class="s9">0</span><span class="s8">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> pdfRect </span><span class="s8">=</span><span class="s1"> pdfContainer</span><span class="s8">.</span><span class="s1">getBoundingClientRect</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> deltaY </span><span class="s8">=</span><span class="s1"> touch</span><span class="s8">.</span><span class="s1">clientY </span><span class="s8">-</span><span class="s1"> startY</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">let</span><span class="s1"> newTop </span><span class="s8">=</span><span class="s1"> startRulerY </span><span class="s8">+</span><span class="s1"> deltaY</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> maxTop </span><span class="s8">=</span><span class="s1"> pdfRect</span><span class="s8">.</span><span class="s1">height </span><span class="s8">-</span><span class="s1"> ruler</span><span class="s8">.</span><span class="s1">offsetHeight</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>newTop </span><span class="s8">=</span><span class="s1"> </span><span class="s13">Math</span><span class="s8">.</span><span class="s1">max</span><span class="s8">(</span><span class="s9">0</span><span class="s8">,</span><span class="s1"> </span><span class="s13">Math</span><span class="s8">.</span><span class="s1">min</span><span class="s8">(</span><span class="s1">newTop</span><span class="s8">,</span><span class="s1"> maxTop</span><span class="s8">));</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>ruler</span><span class="s8">.</span><span class="s1">style</span><span class="s8">.</span><span class="s1">top </span><span class="s8">=</span><span class="s1"> </span><span class="s10">`</span><span class="s8">${</span><span class="s1">newTop</span><span class="s8">}</span><span class="s10">px`</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>rulerY </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">newTop </span><span class="s8">/</span><span class="s1"> </span><span class="s8">(</span><span class="s1">pdfRect</span><span class="s8">.</span><span class="s1">height </span><span class="s8">-</span><span class="s1"> ruler</span><span class="s8">.</span><span class="s1">offsetHeight</span><span class="s8">))</span><span class="s1"> </span><span class="s8">*</span><span class="s1"> </span><span class="s9">100</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">},</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> passive</span><span class="s8">:</span><span class="s1"> </span><span class="s12">false</span><span class="s1"> </span><span class="s8">});</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'touchend'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">isDragging</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>isDragging </span><span class="s8">=</span><span class="s1"> </span><span class="s12">false</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>ruler</span><span class="s8">.</span><span class="s1">style</span><span class="s8">.</span><span class="s1">cursor </span><span class="s8">=</span><span class="s1"> </span><span class="s10">'move'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>saveRulerState</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Re-position ruler on window resize to maintain percentage</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>window</span><span class="s8">.</span><span class="s1">addEventListener</span><span class="s8">(</span><span class="s10">'resize'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">()</span><span class="s1"> </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">isRulerEnabled</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                     </span>positionRuler</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> positionRuler</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> ruler </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'ruler'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> pdfContainer </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'pdfContainer'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">ruler </span><span class="s8">||</span><span class="s1"> </span><span class="s8">!</span><span class="s1">pdfContainer </span><span class="s8">||</span><span class="s1"> </span><span class="s8">!</span><span class="s1">isRulerEnabled</span><span class="s8">)</span><span class="s1"> </span><span class="s12">return</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> pdfRect </span><span class="s8">=</span><span class="s1"> pdfContainer</span><span class="s8">.</span><span class="s1">getBoundingClientRect</span><span class="s8">();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> maxPixelTop </span><span class="s8">=</span><span class="s1"> pdfRect</span><span class="s8">.</span><span class="s1">height </span><span class="s8">-</span><span class="s1"> ruler</span><span class="s8">.</span><span class="s1">offsetHeight</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">let</span><span class="s1"> newTop </span><span class="s8">=</span><span class="s1"> </span><span class="s8">(</span><span class="s1">rulerY </span><span class="s8">/</span><span class="s1"> </span><span class="s9">100</span><span class="s8">)</span><span class="s1"> </span><span class="s8">*</span><span class="s1"> maxPixelTop</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Sanity clamp</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>newTop </span><span class="s8">=</span><span class="s1"> </span><span class="s13">Math</span><span class="s8">.</span><span class="s1">max</span><span class="s8">(</span><span class="s9">0</span><span class="s8">,</span><span class="s1"> </span><span class="s13">Math</span><span class="s8">.</span><span class="s1">min</span><span class="s8">(</span><span class="s1">newTop</span><span class="s8">,</span><span class="s1"> maxPixelTop</span><span class="s8">));</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>ruler</span><span class="s8">.</span><span class="s1">style</span><span class="s8">.</span><span class="s1">top </span><span class="s8">=</span><span class="s1"> </span><span class="s10">`</span><span class="s8">${</span><span class="s1">newTop</span><span class="s8">}</span><span class="s10">px`</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> loadRulerState</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> savedState </span><span class="s8">=</span><span class="s1"> localStorage</span><span class="s8">.</span><span class="s1">getItem</span><span class="s8">(</span><span class="s13">RULER_STATE_KEY</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> savedPos </span><span class="s8">=</span><span class="s1"> localStorage</span><span class="s8">.</span><span class="s1">getItem</span><span class="s8">(</span><span class="s13">RULER_POSITION_KEY</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Load state</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>isRulerEnabled </span><span class="s8">=</span><span class="s1"> savedState </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'true'</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">savedPos </span><span class="s8">!==</span><span class="s1"> </span><span class="s12">null</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>rulerY </span><span class="s8">=</span><span class="s1"> parseFloat</span><span class="s8">(</span><span class="s1">savedPos</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> ruler </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'ruler'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> toggleBtn </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'toggleRulerBtn'</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">ruler </span><span class="s8">&amp;&amp;</span><span class="s1"> toggleBtn</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Apply loaded state to UI</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>ruler</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">toggle</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">!</span><span class="s1">isRulerEnabled</span><span class="s8">);</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Update toggle button colors for dark mode</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>toggleBtn</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">toggle</span><span class="s8">(</span><span class="s10">'bg-red-500'</span><span class="s8">,</span><span class="s1"> isRulerEnabled</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>toggleBtn</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">toggle</span><span class="s8">(</span><span class="s10">'bg-gray-700'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">!</span><span class="s1">isRulerEnabled</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">isRulerEnabled</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>positionRuler</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> saveRulerState</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>localStorage</span><span class="s8">.</span><span class="s1">setItem</span><span class="s8">(</span><span class="s13">RULER_STATE_KEY</span><span class="s8">,</span><span class="s1"> isRulerEnabled</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>localStorage</span><span class="s8">.</span><span class="s1">setItem</span><span class="s8">(</span><span class="s13">RULER_POSITION_KEY</span><span class="s8">,</span><span class="s1"> rulerY</span><span class="s8">.</span><span class="s1">toFixed</span><span class="s8">(</span><span class="s9">2</span><span class="s8">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> toggleRuler</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> ruler </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'ruler'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> toggleBtn </span><span class="s8">=</span><span class="s1"> document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'toggleRulerBtn'</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(!</span><span class="s1">ruler </span><span class="s8">||</span><span class="s1"> </span><span class="s8">!</span><span class="s1">toggleBtn</span><span class="s8">)</span><span class="s1"> </span><span class="s12">return</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>isRulerEnabled </span><span class="s8">=</span><span class="s1"> </span><span class="s8">!</span><span class="s1">isRulerEnabled</span><span class="s8">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>ruler</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">toggle</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">!</span><span class="s1">isRulerEnabled</span><span class="s8">);</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Update toggle button colors for dark mode</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>toggleBtn</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">toggle</span><span class="s8">(</span><span class="s10">'bg-red-500'</span><span class="s8">,</span><span class="s1"> isRulerEnabled</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>toggleBtn</span><span class="s8">.</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">toggle</span><span class="s8">(</span><span class="s10">'bg-gray-700'</span><span class="s8">,</span><span class="s1"> </span><span class="s8">!</span><span class="s1">isRulerEnabled</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">isRulerEnabled</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>positionRuler</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>saveRulerState</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- PDF Logic ---</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">async</span><span class="s1"> </span><span class="s12">function</span><span class="s1"> handleFileUpload</span><span class="s8">(</span><span class="s1">e</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> file </span><span class="s8">=</span><span class="s1"> e</span><span class="s8">.</span><span class="s1">target</span><span class="s8">.</span><span class="s1">files</span><span class="s8">[</span><span class="s9">0</span><span class="s8">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">file </span><span class="s8">&amp;&amp;</span><span class="s1"> file</span><span class="s8">.</span><span class="s1">type </span><span class="s8">===</span><span class="s1"> </span><span class="s10">'application/pdf'</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'emptyState'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'pdfLoader'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">await</span><span class="s1"> savePDFToDB</span><span class="s8">(</span><span class="s1">file</span><span class="s8">);</span><span class="s1"> </span><span class="s7">// Save to IndexedDB</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>loadPDF</span><span class="s8">(</span><span class="s1">file</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> loadPDF</span><span class="s8">(</span><span class="s1">fileData</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">const</span><span class="s1"> fileReader </span><span class="s8">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s13">FileReader</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>fileReader</span><span class="s8">.</span><span class="s1">onload </span><span class="s8">=</span><span class="s1"> </span><span class="s12">function</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> typedarray </span><span class="s8">=</span><span class="s1"> </span><span class="s12">new</span><span class="s1"> </span><span class="s13">Uint8Array</span><span class="s8">(</span><span class="s12">this</span><span class="s8">.</span><span class="s1">result</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>pdfjsLib</span><span class="s8">.</span><span class="s1">getDocument</span><span class="s8">(</span><span class="s1">typedarray</span><span class="s8">).</span><span class="s1">promise</span><span class="s8">.</span><span class="s1">then</span><span class="s8">(</span><span class="s12">function</span><span class="s8">(</span><span class="s1">pdfDoc_</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>pdfDoc </span><span class="s8">=</span><span class="s1"> pdfDoc_</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'pageCount'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> pdfDoc</span><span class="s8">.</span><span class="s1">numPages</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">// Show PDF controls</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'navGroup'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'zoomGroup'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'pdfLoader'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">add</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'the-canvas'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'removePatternBtn'</span><span class="s8">).</span><span class="s1">classList</span><span class="s8">.</span><span class="s1">remove</span><span class="s8">(</span><span class="s10">'hidden'</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>pageNum </span><span class="s8">=</span><span class="s1"> </span><span class="s9">1</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>scale </span><span class="s8">=</span><span class="s1"> </span><span class="s9">1.0</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>renderPage</span><span class="s8">(</span><span class="s1">pageNum</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">}).</span><span class="s12">catch</span><span class="s8">(</span><span class="s1">err </span><span class="s8">=&gt;</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>console</span><span class="s8">.</span><span class="s1">error</span><span class="s8">(</span><span class="s10">"PDF Render Error"</span><span class="s8">,</span><span class="s1"> err</span><span class="s8">);</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span>console</span><span class="s8">.</span><span class="s4">log</span><span class="s8">(</span><span class="s1">"Error opening PDF. It may be corrupted or encrypted."</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>fileReader</span><span class="s8">.</span><span class="s1">readAsArrayBuffer</span><span class="s8">(</span><span class="s1">fileData</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">async</span><span class="s1"> </span><span class="s12">function</span><span class="s1"> clearSavedPattern</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// NOTE: window.confirm is still here, but ideally should be replaced by the custom modal logic</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s8">(</span><span class="s4">window</span><span class="s8">.</span><span class="s4">confirm</span><span class="s8">(</span><span class="s1">"Remove this pattern? You'll need to upload it again next time."</span><span class="s8">))</span><span class="s4"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">await</span><span class="s1"> clearPDFFromDB</span><span class="s8">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>location</span><span class="s8">.</span><span class="s1">reload</span><span class="s8">();</span><span class="s1"> </span><span class="s7">// Simplest way to reset UI</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> renderPage</span><span class="s8">(</span><span class="s1">num</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>pageRendering </span><span class="s8">=</span><span class="s1"> </span><span class="s12">true</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>pdfDoc</span><span class="s8">.</span><span class="s1">getPage</span><span class="s8">(</span><span class="s1">num</span><span class="s8">).</span><span class="s1">then</span><span class="s8">(</span><span class="s12">function</span><span class="s8">(</span><span class="s1">page</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> viewport </span><span class="s8">=</span><span class="s1"> page</span><span class="s8">.</span><span class="s1">getViewport</span><span class="s8">({</span><span class="s1">scale</span><span class="s8">:</span><span class="s1"> scale</span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>canvas</span><span class="s8">.</span><span class="s1">height </span><span class="s8">=</span><span class="s1"> viewport</span><span class="s8">.</span><span class="s1">height</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>canvas</span><span class="s8">.</span><span class="s1">width </span><span class="s8">=</span><span class="s1"> viewport</span><span class="s8">.</span><span class="s1">width</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> renderContext </span><span class="s8">=</span><span class="s1"> </span><span class="s8">{</span><span class="s1"> canvasContext</span><span class="s8">:</span><span class="s1"> ctx</span><span class="s8">,</span><span class="s1"> viewport</span><span class="s8">:</span><span class="s1"> viewport </span><span class="s8">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s12">const</span><span class="s1"> renderTask </span><span class="s8">=</span><span class="s1"> page</span><span class="s8">.</span><span class="s1">render</span><span class="s8">(</span><span class="s1">renderContext</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>renderTask</span><span class="s8">.</span><span class="s1">promise</span><span class="s8">.</span><span class="s1">then</span><span class="s8">(</span><span class="s12">function</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>pageRendering </span><span class="s8">=</span><span class="s1"> </span><span class="s12">false</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">pageNumPending </span><span class="s8">!==</span><span class="s1"> </span><span class="s12">null</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>renderPage</span><span class="s8">(</span><span class="s1">pageNumPending</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>pageNumPending </span><span class="s8">=</span><span class="s1"> </span><span class="s12">null</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s8">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s8">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>document</span><span class="s8">.</span><span class="s1">getElementById</span><span class="s8">(</span><span class="s10">'pageNum'</span><span class="s8">).</span><span class="s1">textContent </span><span class="s8">=</span><span class="s1"> num</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> queueRenderPage</span><span class="s8">(</span><span class="s1">num</span><span class="s8">)</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">pageRendering</span><span class="s8">)</span><span class="s1"> pageNumPending </span><span class="s8">=</span><span class="s1"> num</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">else</span><span class="s1"> renderPage</span><span class="s8">(</span><span class="s1">num</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> onPrevPage</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">pageNum </span><span class="s8">&lt;=</span><span class="s1"> </span><span class="s9">1</span><span class="s8">)</span><span class="s1"> </span><span class="s12">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>pageNum</span><span class="s8">--;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>queueRenderPage</span><span class="s8">(</span><span class="s1">pageNum</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p5"><span class="s1"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">function</span><span class="s1"> onNextPage</span><span class="s8">()</span><span class="s1"> </span><span class="s8">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s12">if</span><span class="s1"> </span><span class="s8">(</span><span class="s1">pageNum </span><span class="s8">&gt;=</span><span class="s1"> pdfDoc</span><span class="s8">.</span><span class="s1">numPages</span><span class="s8">)</span><span class="s1"> </span><span class="s12">return</span><span class="s8">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>pageNum</span><span class="s8">++;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>queueRenderPage</span><span class="s8">(</span><span class="s1">pageNum</span><span class="s8">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s8">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">html</span><span class="s3">&gt;</span></p>
</body>
</html>
